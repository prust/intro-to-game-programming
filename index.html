<canvas id="canvas"></canvas>
<script>
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
canvas.width = document.body.clientWidth;
canvas.height = document.body.clientHeight;
document.body.style.margin = 0;

var player = {
  x: 10,
  y: 10,
  dx: 0,
  dy: 0
};

var bullets = [];

var left = 37;
var right = 39;
var up = 38;
var down = 40;

var is_left_down = false;
var is_right_down = false;
var is_up_down = false;
var is_down_down = false;

document.addEventListener('keydown', function(event) {
  if (event.keyCode == left)
    is_left_down = true;
  else if (event.keyCode == right)
    is_right_down = true;

  if (event.keyCode == up)
    is_up_down = true;
  else if (event.keyCode == down)
    is_down_down = true;
});

document.addEventListener('keyup', function(event) {
  if (event.keyCode == left)
    is_left_down = false;
  else if (event.keyCode == right)
    is_right_down = false;

  if (event.keyCode == up)
    is_up_down = false;
  else if (event.keyCode == down)
    is_down_down = false;
});

document.addEventListener('click', function(event) {
  var bullet = {
  	x: player.x,
  	y: player.y,
  	dx: (event.clientX - player.x) / 10,
  	dy: (event.clientY - player.y) / 10
  };
  bullets.push(bullet);
});

function update() {
  // horizontal movement
  if (is_left_down)
    player.dx = player.dx - 0.1;
  else if (player.dx < 0)
    player.dx = player.dx + 0.1;

  if (is_right_down)
    player.dx = player.dx + 0.1;
  else if (player.dx > 0)
    player.dx = player.dx - 0.1;

  player.x = player.x + player.dx;

  // vertical movement
  if (is_up_down)
    player.dy = player.dy - 0.1;
  else if (player.dy < 0)
    player.dy = player.dy + 0.1;

  if (is_down_down)
    player.dy = player.dy + 0.1;
  else if (player.dy > 0)
    player.dy = player.dy - 0.1;

  player.y = player.y + player.dy;  

  for (var i = 0; i < bullets.length; i++) {
    bullets[i].x = bullets[i].x + bullets[i].dx;
    bullets[i].y = bullets[i].y + bullets[i].dy;
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'blue';
  ctx.fillRect(player.x, player.y, 20, 20);
  
  ctx.fillStyle = 'red';
  for (var i = 0; i < bullets.length; i++)
    ctx.fillRect(bullets[i].x, bullets[i].y, 5, 5);

  requestAnimationFrame(update);
}

requestAnimationFrame(update);

</script>